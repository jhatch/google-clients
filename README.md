# Google API Clients for Node.js

## Setting up Google API credentials

1.  visit [google developer console](https://console.developers.google.com/apis)
2.  click + enable apps and service, find and enable each api: gmail, sheets, calendar
3.  inside your project, go to credentials > create credentials > OAuth client ID
4.  choose "web application"
5.  name it and add "<http://localhost>" as an authorized redirect URI
6.  click create
7.  copy client_id and client_secret into `credentials.json` in the root of your project see [credentials.json](./_credentials.json) for an example
8.  execute `google.generateAuthUrl`, see example below
9.  find the token value in the redirect url in your browser
10. execute `google.getToken` passing the token from #8, see example below
11. copy the token JSON into [credentials.json](./credentials.json) under your api name ie "sheets"

```javascript
const { GoogleAPI } = require('google-clients');
const credentials = require('./credentials.json');

const google = new GoogleAPI({ oauth: credentials.oauth });

// scopes:
// https://www.googleapis.com/auth/spreadsheets
// https://www.googleapis.com/auth/calendar.readonly
// https://www.googleapis.com/auth/gmail.send

google.generateAuthUrl(['']); // <-- scope
google.generateToken(''); // <-- token from first step
```

## Documentation

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [GoogleAPI](#googleapi)
    -   [Parameters](#parameters)
    -   [authorize](#authorize)
        -   [Parameters](#parameters-1)
    -   [getApiVersion](#getapiversion)
-   [GoogleCalendar](#googlecalendar)
    -   [Parameters](#parameters-2)
    -   [load](#load)
        -   [Parameters](#parameters-3)
    -   [getNextEvent](#getnextevent)
        -   [Parameters](#parameters-4)
    -   [getLastEvent](#getlastevent)
        -   [Parameters](#parameters-5)
    -   [isScheduled](#isscheduled)
        -   [Parameters](#parameters-6)
    -   [computeWeeksSinceLastSeen](#computeweekssincelastseen)
        -   [Parameters](#parameters-7)
    -   [computeLastSeenScore](#computelastseenscore)
        -   [Parameters](#parameters-8)
-   [GoogleCalendarEvent](#googlecalendarevent)
    -   [Parameters](#parameters-9)
    -   [isAttending](#isattending)
        -   [Parameters](#parameters-10)
    -   [isFuture](#isfuture)
    -   [toObject](#toobject)
    -   [cleanEmail](#cleanemail)
        -   [Parameters](#parameters-11)
    -   [emailMatch](#emailmatch)
        -   [Parameters](#parameters-12)
    -   [sortByDateAsc](#sortbydateasc)
        -   [Parameters](#parameters-13)
    -   [sortByDateDesc](#sortbydatedesc)
        -   [Parameters](#parameters-14)
-   [GoogleMail](#googlemail)
    -   [send](#send)
        -   [Parameters](#parameters-15)
-   [GoogleSheet](#googlesheet)
    -   [Parameters](#parameters-16)
    -   [load](#load-1)
        -   [Parameters](#parameters-17)
    -   [update](#update)
        -   [Parameters](#parameters-18)

### GoogleAPI

[lib/GoogleAPI.js:8-65](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleAPI.js#L8-L65 "Source code on GitHub")

Handle oauth handshake for any Google API, usually extended

#### Parameters

-   `creds` **{oauth: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), token: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}** 

#### authorize

[lib/GoogleAPI.js:29-45](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleAPI.js#L29-L45 "Source code on GitHub")

Create an OAuth2 client with the given credentials and then
create an api client with the given token

##### Parameters

-   `oAuth` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)**  (optional, default `{}`)
-   `token` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)**  (optional, default `{}`)

#### getApiVersion

[lib/GoogleAPI.js:18-21](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleAPI.js#L18-L21 "Source code on GitHub")

should be overriden by child class

Returns **{name: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), version: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}** 

### GoogleCalendar

[lib/GoogleCalendar.js:10-151](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendar.js#L10-L151 "Source code on GitHub")

Pull event data from your Google Calendar

#### Parameters

-   `creds` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

#### load

[lib/GoogleCalendar.js:50-70](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendar.js#L50-L70 "Source code on GitHub")

load all events on your calendar for given time range

##### Parameters

-   `from` **[Date](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Date)** 
-   `to` **[Date](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Date)** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** 

#### getNextEvent

[lib/GoogleCalendar.js:78-86](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendar.js#L78-L86 "Source code on GitHub")

get the next event in the future that
has given email as an attendee

##### Parameters

-   `email` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **([GoogleCalendarEvent](#googlecalendarevent) | null)** 

#### getLastEvent

[lib/GoogleCalendar.js:94-102](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendar.js#L94-L102 "Source code on GitHub")

get the last event in the past that
has given email as an attendee

##### Parameters

-   `email` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **([GoogleCalendarEvent](#googlecalendarevent) | null)** 

#### isScheduled

[lib/GoogleCalendar.js:110-114](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendar.js#L110-L114 "Source code on GitHub")

return true if any event in the future
has given email as an attendee

##### Parameters

-   `email` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

#### computeWeeksSinceLastSeen

[lib/GoogleCalendar.js:123-133](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendar.js#L123-L133 "Source code on GitHub")

Count how many weeks it's been
since you last had an event with
the given attendee

##### Parameters

-   `email` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** \-1, no events with this attendee found

#### computeLastSeenScore

[lib/GoogleCalendar.js:145-150](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendar.js#L145-L150 "Source code on GitHub")

Based on your target frequency in seeing someone, compute
based on how long since you last saw them - how far off you are

weeks since seen / target weeks apart

##### Parameters

-   `email` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `targetFrequency` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** weekly|monthly|quarterly|biannually|annually

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

### GoogleCalendarEvent

[lib/GoogleCalendarEvent.js:9-110](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendarEvent.js#L9-L110 "Source code on GitHub")

Add utilities, handle data inconsistencies, and provide a clean
interface for interacting with
<a href="https://developers.google.com/calendar/v3/reference/events">Google Calendar Event data</a>

#### Parameters

-   `rawApiEventData`  

#### isAttending

[lib/GoogleCalendarEvent.js:85-88](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendarEvent.js#L85-L88 "Source code on GitHub")

Is the given email on your attendee list?

##### Parameters

-   `email` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

#### isFuture

[lib/GoogleCalendarEvent.js:94-96](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendarEvent.js#L94-L96 "Source code on GitHub")

Is this event currently in the future?

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

#### toObject

[lib/GoogleCalendarEvent.js:103-109](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendarEvent.js#L103-L109 "Source code on GitHub")

Get an object representation of this event for us in
email template rendering

Returns **{summary, htmlLink, date}** 

#### cleanEmail

[lib/GoogleCalendarEvent.js:23-30](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendarEvent.js#L23-L30 "Source code on GitHub")

clean an email so its reliable in a comparison
remove: white space and periods

##### Parameters

-   `email` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

#### emailMatch

[lib/GoogleCalendarEvent.js:38-40](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendarEvent.js#L38-L40 "Source code on GitHub")

clean and compare two emails

##### Parameters

-   `emailA` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `emailB` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

#### sortByDateAsc

[lib/GoogleCalendarEvent.js:49-59](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendarEvent.js#L49-L59 "Source code on GitHub")

Implement a compare function for Array#sort on events
to sort by date ascending

##### Parameters

-   `a` **[GoogleCalendarEvent](#googlecalendarevent)** 
-   `b` **[GoogleCalendarEvent](#googlecalendarevent)** 

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 1: greater, -1: less, 0: equal

#### sortByDateDesc

[lib/GoogleCalendarEvent.js:68-78](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleCalendarEvent.js#L68-L78 "Source code on GitHub")

Implement a compare function for Array#sort on events
to sort by date descending

##### Parameters

-   `a` **[GoogleCalendarEvent](#googlecalendarevent)** 
-   `b` **[GoogleCalendarEvent](#googlecalendarevent)** 

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 1: greater, -1: less, 0: equal

### GoogleMail

[lib/GoogleMail.js:7-50](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleMail.js#L7-L50 "Source code on GitHub")

**Extends GoogleAPI**

Send emails through your G-Mail account

#### send

[lib/GoogleMail.js:18-49](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleMail.js#L18-L49 "Source code on GitHub")

Send some HTML through your gmail account

##### Parameters

-   `from` **{name: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), email: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}** 
-   `to` **{name: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), email: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}** 
-   `contents` **{subject: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), html: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}** 

### GoogleSheet

[lib/GoogleSheet.js:9-84](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleSheet.js#L9-L84 "Source code on GitHub")

**Extends GoogleAPI**

Read and write rows in a Google Sheet

#### Parameters

-   `creds` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
-   `config` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)**  (optional, default `{}`)

#### load

[lib/GoogleSheet.js:40-56](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleSheet.js#L40-L56 "Source code on GitHub")

Load a given range in a given sheet

##### Parameters

-   `sheetId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `range` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** 

#### update

[lib/GoogleSheet.js:66-83](https://github.com/jhatch/google-clients/blob/bbcafbc6202a44de1026eff966c57c80dbeb7e5c/lib/GoogleSheet.js#L66-L83 "Source code on GitHub")

Write the given values into the given range of
the given sheet

##### Parameters

-   `id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `range` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `values` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)>** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** 

## Tests

      [class] GoogleAPI
        [method] authorize
          ✓ should instantiate with a default config

      [class] GoogleCalendar
        [method] constructor
          ✓ should export a constructor
        [method] load
          ✓ should load calendar data, returning a promise
          ✓ should load calendar data, await syntax
          ✓ should reject w/error
        [method] getNextEvent
          ✓ should return null if email is not on any future events
          ✓ should return null if email is only on a past event
          ✓ should return the date if email is on a future event
          ✓ should return the date if email is on a future event using date field
        [method] getLastEvent
          ✓ should return null if no prior event is found
          ✓ should return null if no prior event is found, ignoring future events
          ✓ should return the last prior event found
          ✓ should return the date of the most recent prior event found
          ✓ should return the stable order date of the most recent prior event found
        [method] isScheduled
          ✓ should return false if email is not on any future events
          ✓ should return false if email is only on a past event
          ✓ should return true if email is on a future event
        [method] computeWeeksSinceLastSeen
          ✓ should return -1 if no prior event is found
          ✓ should return -1 if no prior event is found, ignoring future events
          ✓ should return the number of weeks since the last prior event found
          ✓ should return the number of weeks since the most recent prior event found
        [method] computeLastSeenScore
          ✓ should correctly compute: weekly, never seen => 0
          ✓ should correctly compute: weekly, 3 weeks => 3/1 => 3.0
          ✓ should correctly compute: monthly, 3 weeks => 3/4 => 0.75
          ✓ should correctly compute: quarterly, 10 weeks => 10/12 => 0.83
          ✓ should correctly compute: biannually, 10 weeks => 10/26 => 0.38
          ✓ should correctly compute: annually, 26 weeks => 26/52 => 0.5
          ✓ should correctly compute: quarterly, 1 week => 1/12 => 0.08

      [class] GoogleCalendarEvent
        [static]
          [method] emailMatch, using [method] cleanEmail
            ✓ should match regardless of periods before the @
            ✓ should match regardless of case
            ✓ should match regardless of trailing/leading whitespace
          [method] sortByDateAsc
            ✓ should sort by start date, ascending
          [method] sortByDateDesc
            ✓ should sort by start date, descending
        [method] isAttending
          ✓ should return false if no attendees
          ✓ should return false if email does not match attendees
          ✓ should return true if email does match attendees
        [method] isFuture
          ✓ should return false if event is in the past
          ✓ should return true if event is in the future
          ✓ should return false if event is now
        [method] toObject
          ✓ should return only the necessary fields

      [class] GoogleSheet
        [method] constructor
          ✓ should export a constructor
        [method] load
          ✓ should load sheet data, returning a promise
          ✓ should reject w/error
          ✓ should load sheet data, await syntax
          ✓ should load sheet data raw if no column headers given
          ✓ should load sheet data inflated if column headers given
        [method] inflateRow
          ✓ should convert a flat row to an object
        [method] update
          ✓ should update sheet data, await syntax
          ✓ should reject w/error


      49 passing (103ms)

    ------------------------|----------|----------|----------|----------|-------------------|
    File                    |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |
    ------------------------|----------|----------|----------|----------|-------------------|
    All files               |      100 |      100 |      100 |      100 |                   |
     GoogleAPI.js           |      100 |      100 |      100 |      100 |                   |
     GoogleCalendar.js      |      100 |      100 |      100 |      100 |                   |
     GoogleCalendarEvent.js |      100 |      100 |      100 |      100 |                   |
     GoogleSheet.js         |      100 |      100 |      100 |      100 |                   |
    ------------------------|----------|----------|----------|----------|-------------------|
